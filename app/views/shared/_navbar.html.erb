<div class="navbar navbar-expand-sm navbar-light navbar-lewagon nav-content sticky">
  <div class="navbar-brand">
    <%= link_to image_tag("logo.png"), root_path %>
    <h4>The Ecosystem</h4>
  </div>
  <div class="middle-links">
    <ul>
      <li> <%= link_to "Best Rated", search_path %> </li>
      <li> <%= link_to "Recommended", search_path %> </li>
      <li> <%= link_to "Info" %> </li>
    </ul>
  </div>
  <div class="search-log">

    <%= form_tag search_path, method: :get do %>
      <%= text_field_tag :query, params[:query], class: "form-control nav-search", placeholder: "Find your solution!" %>
    <% end %>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <% if user_signed_in? %>
        <% convs_sender = current_user.conversations_as_sender %>
        <% convs_receiver = current_user.conversations_as_receiver %>
        <% sum = 0 %>
        <% convs_sender.each do |conv| %>
          <% sum += conv.sender_notifications %>
        <% end %>
        <% convs_receiver.each do |conv| %>
          <% sum += conv.receiver_notifications %>
        <% end %>
        <li class="nav-item">

          <%= link_to "Create post", new_post_path, class: " nav-link" %>

        </li>
        <li class="nav-item dropdown">
          <% if current_user.prof_pic.attached? %>

            <div style="position:relative"> 

              <% if sum > 0 %>
                <div class="nav-badge badge"><%= sum %></div>
              <% else %>
                <div class="nav-badge badge" style="display: none;">0</div>
              <% end %>


            </div><%= cl_image_tag current_user.prof_pic.key, class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>


          <% else %>
            <%= image_tag "https://res.cloudinary.com/ddclrx1ajasdf/image/upload/v1614812119/placeholder_avatar/1200px-Avatar_icon_green.svg_tire2w.png", class: "avatar dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
          <% end %>
          <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
            <%= link_to "My Profile", profile_path(current_user), class: "dropdown-item" %>
            <div style="position:relative"><%= link_to "Messages", conversations_path, class: "dropdown-item" %>
              
              <% if sum > 0 %>
                <div class="msg-dropdown-badge badge"><%= sum %></div>
              <% else %>
                <div class="msg-dropdown-badge badge" style="display: none;">0</div>
              <% end %>

            </div>
            <%= link_to "My Posts", posts_path, class: "dropdown-item" %>
            <%= link_to "Account Settings", edit_user_registration_path, class: "dropdown-item" %>
            <%= link_to "Logout", destroy_user_session_path, method: :delete, class: "dropdown-item" %>
          </div>
        </li>
      <% else %>
        <li class="nav-links">
          <%= link_to "Login", new_user_session_path %>
           | <%= link_to "Sign Up", new_user_registration_path %>
        </li>
      <% end %>
    </ul>
    </div>
  </div>

</div>
