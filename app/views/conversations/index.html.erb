<div data-controller="conversation">
  <div class="wrapper">
    <!-- Sidebar -->
    <nav id="sidebar">
      <div class="sidebar-header">
        <h3>Conversations</h3>
      </div>
      <% if @conversations.count > 0 %>

        <ul class="list-unstyled components">
            <% @conversations.each do |conversation| %>
              <% if conversation.sender == current_user %>
                    <li data-action="click->conversation#refresh" data-id="<%= conversation.id %>"  >
                        <%= link_to conversation.receiver.nickname, conversation_path(conversation), remote: true%>
                        <%# ################# for unseen notifications ################# %>
                        <%# receiver_unseen_msgs = conversation.messages.where(user: conversation.receiver, seen: false).count %>
                    </li>
              <% else %>
                <li data-action="click->conversation#refresh" data-id="<%= conversation.id %>">
                    <%= link_to conversation.sender.nickname, conversation_path(conversation), remote: true %>
                    <%# ################# for unseen notifications ################# %>
                    <%# sender_unseen_msgs = conversation.messages.where(user: conversation.sender, seen: false).count %>
                </li>
              <% end %>
            <% end %>
        </ul>

      <% end %>
    </nav>

    <div class="chat">
      <% if @conversations.count > 0 %>

          <div class="conversation" data-conversation-target="conversationcon">
            <div id="messages" data-conversation-id="<%= @conversations.last.id %>">
                <div class="message-container" id="message-0"></div>
                <% @conversations.last.messages.each do |message| %>
                  <%= render "messages/message", message: message %>
                <% end %>
            </div>
          </div>

          <span class="sendfield" id="chat-text" style="width: 800px;" data-conversation-target="sendcon">
            <span id="send">
              <%= simple_form_for [ @conversations.last, @message ] , html: { autocomplete: 'off' } do |f| %>
                <%= f.input :content, label: false, placeholder: "Message", remote: true %>
              <% end %>
            </span>
          </span>

      <% else %>
        <div><h4>You dont have any conversations yet.</h4></div>
      <% end %>
    </div>
  </div>
</div>

<script>
  function clearText() {
    var sentMsg = document.querySelector('.form-control')
    if (sentMsg){
      sentMsg.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
          sentMsg.value = ""
        }
      });
    }
  }
  
  document.addEventListener('change', (event) => {
  clearText()
});
</script>